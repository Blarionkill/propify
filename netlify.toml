# Netlify build configuration for Propify
#
# This file injects your Supabase credentials at build time using
# Netlify environment variables, so you never have to hardcode secrets.
#
# Setup:
#   1. In Netlify go to: Site settings → Environment variables
#   2. Add these two variables:
#        SUPABASE_URL      = https://xxxxxxxxxxxx.supabase.co
#        SUPABASE_ANON_KEY = eyJhbGci...
#   3. Trigger a new deploy — the sed command below will replace the
#      placeholders in propify_app.html automatically.
#
# If you prefer to edit propify_app.html directly (hardcode the values),
# you can delete this file and leave the build command empty in Netlify.

[build]
  command     = "sed -i 's|YOUR_SUPABASE_URL|'\"$SUPABASE_URL\"'|g' propify_app.html && sed -i 's|YOUR_SUPABASE_ANON_KEY|'\"$SUPABASE_ANON_KEY\"'|g' propify_app.html"
  publish     = "."

# ---------------------------------------------------------------
# Global headers applied to every response.
# X-Robots-Tag tells search engines not to index or follow links,
# reducing bot traffic and bandwidth consumption.
# ---------------------------------------------------------------
[[headers]]
  for = "/*"
  [headers.values]
    X-Robots-Tag        = "noindex, nofollow"
    X-Content-Type-Options = "nosniff"
    Vary                = "Accept-Encoding"

# ---------------------------------------------------------------
# Cache the app HTML for 1 hour (3600 s).
# Netlify invalidates this cache on every new deploy, so users
# always get the latest version after a release.
# stale-while-revalidate=86400 lets the browser serve the cached
# copy instantly while refreshing in the background, eliminating
# perceived load time on repeat visits.
# ---------------------------------------------------------------
[[headers]]
  for = "/propify_app.html"
  [headers.values]
    Cache-Control = "public, max-age=3600, stale-while-revalidate=86400"

# Cache the robots.txt for 1 day so bots don't re-fetch it on
# every visit.
[[headers]]
  for = "/robots.txt"
  [headers.values]
    Cache-Control = "public, max-age=86400"

# Cache long-lived static assets (e.g. future JS/CSS files) aggressively.
[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
